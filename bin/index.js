function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var n=e(require("chalk")),r=e(require("fs")),t=require("child_process"),o=process.argv.slice(2),i=n.magenta,s=i.bold,a=n.red,c=n.blue,u=require("../package.json"),l="@faharmony",f=[{name:"components"},{name:"globalbar"},{name:"helpers",types:["uuid"]},{name:"hooks"},{name:"icons"},{name:"layouts"},{name:"locale"},{name:"module"},{name:"navigation"},{name:"router",types:["react-router-dom"]},{name:"service"},{name:"state",types:["react-redux","webpack-env"]},{name:"theme"},{name:"views"}],m=[{name:"core",types:["node","react"]},{name:"table",types:["react-table"]},{name:"charts",types:["lodash"]},{name:"form"}],h=["stable","latest","snapshot","dev","rc","freeze"],v={nodeModules:process.cwd()+"/node_modules/",yarnLock:process.cwd()+"/yarn.lock"},d=r.existsSync(v.yarnLock),g=function(){return d?"yarn add":"npm install"},p=function(){return d?"Yarn":"NPM"};const y=function(){function e(){}return e.prototype.then=function(n,r){const t=new e,o=this.s;if(o){const e=1&o?n:r;if(e){try{P(t,1,e(this.v))}catch(e){P(t,2,e)}return t}return this}return this.o=function(e){try{const o=e.v;1&e.s?P(t,1,n?n(o):o):r?P(t,1,r(o)):P(t,2,o)}catch(e){P(t,2,e)}},t},e}();function P(e,n,r){if(!e.s){if(r instanceof y){if(!r.s)return void(r.o=P.bind(null,e,n));1&n&&(n=r.s),r=r.v}if(r&&r.then)return void r.then(P.bind(null,e,n),P.bind(null,e,2));e.s=n,e.v=r;const t=e.o;t&&t(e)}}function b(e){return e instanceof y&&1&e.s}function w(e,n,r){var t,o,i=-1;return function s(a){try{for(;++i<e.length&&(!r||!r());)if((a=n(i))&&a.then){if(!b(a))return void a.then(s,o||(o=P.bind(null,t=new y,2)));a=a.v}t?P(t,1,a):t=a}catch(e){P(t||(t=new y),2,e)}}(),t}const j="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function S(e,n,r){if("function"==typeof e[j]){var t,o,i,s=e[j]();if(function e(a){try{for(;!((t=s.next()).done||r&&r());)if((a=n(t.value))&&a.then){if(!b(a))return void a.then(e,i||(i=P.bind(null,o=new y,2)));a=a.v}o?P(o,1,a):o=a}catch(e){P(o||(o=new y),2,e)}}(),s.return){var a=function(e){try{t.done||s.return()}catch(e){}return e};if(o&&o.then)return o.then(a,function(e){throw a(e)});a()}return o}if(!("length"in e))throw new TypeError("Object is not iterable");for(var c=[],u=0;u<e.length;u++)c.push(e[u]);return w(c,function(e){return n(c[e])},r)}"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator"))),process.on("unhandledRejection",console.log);var k=function(e,n,r){return void 0===n&&(n=""),void 0===r&&(r=!0),new Promise(function(o){t.exec(e,function(e,t,i){if(e)return r&&console.error(a("error: "+e.message)),void o(e.message);""!==n&&console.log(s(n+"\n")),o(t||i)})})},x=function(e){return l+"/"+e},I=function(e){return e.map(function(e){return"@types/"+e}).join(" ")},C=function(){try{var e=require(process.cwd()+"/package.json"),n=e.dependencies["@faharmony/core"].replace("^",""),r=n.includes("RC")?"RC":n.includes("SNAPSHOT")?"SNAPSHOT":"latest";return{version:n,tag:r,name:e.name}}catch(e){return null}},A=function(e){try{var n=require(v.nodeModules+x(e)+"/package.json"),r=n.version,t=r.includes("RC")?"RC":r.includes("SNAPSHOT")?"SNAPSHOT":"latest";return{version:r,tag:t,name:n.name}}catch(e){return null}},T=function(){return console.log("Use param --help or -h for help.")},N=function(e){return m.find(function(n){return n.name===e})},L=function(e,n,r){void 0===r&&(r="");try{var t=n.name,o=n.types,s="Installing package "+x(t)+"@"+e+" using "+p();return console.log(i(s)),Promise.resolve(k(g()+" "+x(n.name)+"@"+e+" "+r,x(t)+"@"+e.toUpperCase()+" installed successfully.")).then(function(){var e=o||[],n=function(){if(e.length>0)return Promise.resolve(k(g()+" --no-save "+I(e))).then(function(){})}();if(n&&n.then)return n.then(function(){})})}catch(e){return Promise.reject(e)}},M=function(e,n){void 0===e&&(e="latest"),void 0===n&&(n=[]);try{0===n.length&&(m.forEach(function(e){A(e.name)&&n.push(e.name)}),n.includes("core")||n.push("core"));var r=m.filter(function(e){return n.includes(e.name)});return Promise.resolve(k("rm -rf "+v.nodeModules+"/"+l)).then(function(){function n(){function n(){return Promise.resolve(function(n,r){try{var t=w(n,function(r){return Promise.resolve(function(n){try{var r=function(){var e=function(){if(o.length>0)return Promise.resolve(k(g()+" -D "+I(o))).then(function(){})}();if(e&&e.then)return e.then(function(){})},t=x(n.name),o=n.types||[],s=C(),a=A(n.name),c=function(){if(!a||!s)return console.log(i("Installing library "+t+"@"+e+" using "+p())),Promise.resolve(k(g()+" "+t+"@"+e)).then(function(){});var n=s.version,r=function(){if(a.version!==n)return console.log(i("Installing library "+t+"@"+n+" using "+p())),Promise.resolve(k(g()+" "+t+"@"+n)).then(function(){})}();return r&&r.then?r.then(function(){}):void 0}();return Promise.resolve(c&&c.then?c.then(r):r())}catch(e){return Promise.reject(e)}}(n[r])).then(function(){})});return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}(f)).then(function(){var e=function(){if(!d)return Promise.resolve(k("npm dedupe")).then(function(){})}();if(e&&e.then)return e.then(function(){})})}var r=S(f,function(n){function r(){var e=function(){if(s.length>0)return Promise.resolve(k(g()+" -D "+I(s))).then(function(){})}();if(e&&e.then)return e.then(function(){})}var t=function(e,n){return console.log(i("Installing library "+e+"@"+n+" using "+p()))},o=x(n.name),s=n.types||[],a=C(),c=A(n.name),u=function(){if(!c||!a)return t(o,e),Promise.resolve(k(g()+" "+o+"@"+e+" --no-save")).then(function(){});var n=a.version,r=function(){if(c.version!==n)return t(o,n),Promise.resolve(k(g()+" "+o+"@"+n+" --no-save")).then(function(){})}();return r&&r.then?r.then(function(){}):void 0}();return u&&u.then?u.then(r):r()});return r&&r.then?r.then(n):n()}var t=S(r,function(n){return Promise.resolve(L(e,n)).then(function(){})});return t&&t.then?t.then(n):n()})}catch(e){return Promise.reject(e)}},O={tag:{param:["--tag","-t"],description:"Install specific tagged version of harmony.",values:h,usage:h[0],exec:function(){try{var e=o[1]?o[1].trim().toLowerCase():"";if(""===e)return console.log(a("Tag was not provided in command.")),console.log("[ "+h.join(", ")+" ]"),Promise.resolve();switch(e){case"latest":case"stable":return Promise.resolve(M("latest",[])).then(function(){});case"rc":case"freeze":return Promise.resolve(M("RC",[])).then(function(){});case"snapshot":case"dev":return Promise.resolve(M("SNAPSHOT",[])).then(function(){});default:return console.log(a("Package name is incorrect.")),T(),Promise.resolve()}}catch(e){return Promise.reject(e)}}},install:{param:["--install","-i"],description:"Install harmony's packages.",values:m.map(function(e){return e.name}).filter(function(e){return"core"!==e}),usage:"table",exec:function(){try{var e=o[1]?o[1].trim().toLowerCase():"",n=function(){if(""===e)console.log(a("Package name was not provided in command."));else{var n=function(){if("core"===e)return Promise.resolve(M()).then(function(){});var n=function(){if(N(e))return Promise.resolve(function(e){try{var n=C(),r=N(e),t=function(){if(n&&r){var t={init:"Installing package "+x(e)+"@"+n.tag+" using "+p(),success:x(e)+"@"+n.tag+" installed successfully."};return Promise.resolve(function(e){var n=e.pkg,r=n.name,t=n.types,o=void 0===t?[]:t,s=e.version,c=e.options,u=void 0===c?"":c,l=e.messages;try{var f=function(e,n){try{var t=function(){console.log(i(null==l?void 0:l.init));var e=x(r)+"@"+s,n=g()+" "+e+" "+u;return Promise.resolve(k(n,null==l?void 0:l.success)).then(function(){var e=I(o),n=g()+" --no-save "+e,r=function(){if(o.length>0)return Promise.resolve(k(n)).then(function(){})}();if(r&&r.then)return r.then(function(){})})}()}catch(e){return n()}return t&&t.then?t.then(void 0,n):t}(0,function(){console.log(a((null==l?void 0:l.error)||"Error occurred."))});return Promise.resolve(f&&f.then?f.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}({messages:t,version:n.tag,pkg:r})).then(function(){})}console.log(a("A version of @faharmony/core must be installed before installing other packages. \nTry running command again with tag params or no params (for latest).")),T()}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}(e)).then(function(){});console.log(a("Package name is incorrect.")),T()}();return n&&n.then?n.then(function(){}):void 0}();if(n&&n.then)return n.then(function(){})}}();return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}},module:{param:["--module","-m"],description:"Generate harmony module using plop.",values:["a ModuleID (string with all-lowercase letters)"],usage:"sample",exec:function(){try{var e=function(e){return console.log(i("Initiating module generator script...")),Promise.resolve(k("npx plop --plopfile "+v.nodeModules+l+"/"+r+"/plop.js "+n,'New module "'+n+'" is generated.',!0)).then(function(){})},n=o[1]?o[1].trim().toLowerCase():"";if(""===n)return console.log(a("ModuleID was not provided in command.")),T(),Promise.resolve();var r="module",t=A(r),s=N(r);return Promise.resolve(s?Promise.resolve(L(t&&t.tag||"latest",s,"--no-save")).then(e):e())}catch(e){return Promise.reject(e)}}},sync:{param:["--sync","-s"],description:"Synchronize current branch with template repo.",exec:function(){try{return console.log(i("Stating sync...\n")),Promise.resolve(k("git remote add upstream git@bitbucket.org:fasolutions-ondemand/fa-react-app.git")).then(function(){return Promise.resolve(k("git fetch upstream")).then(function(){return Promise.resolve(k("git merge upstream/master")).then(function(e){"Already up to date."===e?console.log(s("The app is in sync.")):console.log(i("Syncing may require resolving some merge conflicts.\nResolve the conflicts and commit the changes."))})})})}catch(e){return Promise.reject(e)}}},version:{param:["--version","-v"],description:"Check installed version of harmony",exec:function(){try{var e=C();return e?console.log(i("Installed version of harmony is \n"+s(e.version)+" (tag:"+e.tag+").")):(console.log(a("No installed version of harmony \nfound in this application.")),T()),console.log("\nHarmony is FA Solutions' framework\nfor React-based app development.\nThe CLI is made to manage harmony's \npackages and versioning in the apps.\nContributors:"),u.contributors.forEach(function(e){return console.log("  %s",e)}),Promise.resolve()}catch(e){return Promise.reject(e)}}},help:{param:["--help","-h"],description:"Displays this message.",exec:function(){try{console.log("Usage: "+s("npx faharmony/cli [param]")),console.log("where param (case-insensitive) is "+n.bold("one")+" of the following:");var e=n.green,r=n.blue;for(var t in O){var o=O[t],a=o.param,c=o.description,u=o.values,l=o.usage;console.log(i(a.join(", "))+"\t"+c),u&&console.log("  param value:\t"+r(u.join(", "))),l&&console.log("\t\t%s",e("npx faharmony/cli "+a[0]+" "+l))}return Promise.resolve()}catch(e){return Promise.reject(e)}}}},R="Welcome to FA harm☯️ny CLI ",q=R.length+4,E=Array(q).join("━"),H=(Array(q).join(" "),o.length?"Param: "+o.join(" "):"No param"),D=Array(R.length-H.length).join(" "),z="┏"+E+"┓",F="┃  "+s(R)+"  ┃",U="┗"+E+"┛",_="┃  "+H+D+"  ┃";!function(){try{var e=function(){console.log(i("\nMade with 💜 at FA Solutions Oy.")+"\n"+c("https://github.com/faharmony/cli")+"\n"+E+"━━")};console.log("\n"+z+"\n"+F+"\n"+_+"\n"+U+"\n");var r=function(){if(o.length>0)return Promise.resolve(function(){try{var e=o[0].trim().toLowerCase(),r={name:"",exec:function(){return Promise.resolve()}};Object.entries(O).forEach(function(n){var t=n[0],o=n[1];"string"!=typeof o&&o.param.includes(e)&&(r={name:t,exec:o.exec})});var t=function(){if(""!==r.name)return Promise.resolve(r.exec()).then(function(){});console.log(n.red.bold("Error: The command is incorrect.")),T()}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}()).then(function(){});var e=C(),r=e?Promise.resolve(M(e.tag,[])).then(function(){}):Promise.resolve(M("latest")).then(function(){});return r&&r.then?r.then(function(){}):void 0}();r&&r.then?r.then(e):e()}catch(e){Promise.reject(e)}}();
