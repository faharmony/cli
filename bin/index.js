function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var n=e(require("chalk")),r=e(require("fs")),o=require("child_process"),t=process.argv.slice(2),i=n.magenta,s=i.bold,c=n.red,a=n.blue,u=require("../package.json"),l="@faharmony",f=[{name:"components"},{name:"globalbar"},{name:"helpers",types:["uuid"]},{name:"hooks"},{name:"icons"},{name:"layouts"},{name:"locale"},{name:"module"},{name:"navigation"},{name:"router",types:["react-router-dom"]},{name:"service"},{name:"state",types:["react-redux","webpack-env"]},{name:"theme"},{name:"views"}],m=[{name:"core",types:["node","react"]},{name:"table",types:["react-table"]},{name:"charts",types:["lodash"]},{name:"form"}],h=["stable","latest","snapshot","dev","rc","freeze"],v={nodeModules:process.cwd()+"/node_modules/",yarnLock:process.cwd()+"/yarn.lock"},d=r.existsSync(v.yarnLock),g=function(){return d?"yarn add":"npm install"},p=function(){return d?"Yarn":"NPM"};const y=function(){function e(){}return e.prototype.then=function(n,r){const o=new e,t=this.s;if(t){const e=1&t?n:r;if(e){try{P(o,1,e(this.v))}catch(e){P(o,2,e)}return o}return this}return this.o=function(e){try{const t=e.v;1&e.s?P(o,1,n?n(t):t):r?P(o,1,r(t)):P(o,2,t)}catch(e){P(o,2,e)}},o},e}();function P(e,n,r){if(!e.s){if(r instanceof y){if(!r.s)return void(r.o=P.bind(null,e,n));1&n&&(n=r.s),r=r.v}if(r&&r.then)return void r.then(P.bind(null,e,n),P.bind(null,e,2));e.s=n,e.v=r;const o=e.o;o&&o(e)}}function b(e){return e instanceof y&&1&e.s}function w(e,n,r){var o,t,i=-1;return function s(c){try{for(;++i<e.length&&(!r||!r());)if((c=n(i))&&c.then){if(!b(c))return void c.then(s,t||(t=P.bind(null,o=new y,2)));c=c.v}o?P(o,1,c):o=c}catch(e){P(o||(o=new y),2,e)}}(),o}const j="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function S(e,n,r){if("function"==typeof e[j]){var o,t,i,s=e[j]();if(function e(c){try{for(;!((o=s.next()).done||r&&r());)if((c=n(o.value))&&c.then){if(!b(c))return void c.then(e,i||(i=P.bind(null,t=new y,2)));c=c.v}t?P(t,1,c):t=c}catch(e){P(t||(t=new y),2,e)}}(),s.return){var c=function(e){try{o.done||s.return()}catch(e){}return e};if(t&&t.then)return t.then(c,function(e){throw c(e)});c()}return t}if(!("length"in e))throw new TypeError("Object is not iterable");for(var a=[],u=0;u<e.length;u++)a.push(e[u]);return w(a,function(e){return n(a[e])},r)}"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator"))),process.on("unhandledRejection",console.log);var k=function(e,n,r){return void 0===n&&(n=""),void 0===r&&(r=!0),new Promise(function(t){o.exec(e,function(e,o,i){if(e)return r&&console.error(c("error: "+e.message)),void t(e.message);""!==n&&console.log(s(n+"\n")),t(o||i)})})},x=function(e){return l+"/"+e},A=function(e){return e.map(function(e){return"@types/"+e}).join(" ")},I=function(){try{var e=require(process.cwd()+"/package.json"),n=e.dependencies["@faharmony/core"].replace("^",""),r=n.includes("RC")?"RC":n.includes("SNAPSHOT")?"SNAPSHOT":"latest";return{version:n,tag:r,name:e.name}}catch(e){return null}},C=function(e){try{var n=require(v.nodeModules+x(e)+"/package.json"),r=n.version,o=r.includes("RC")?"RC":r.includes("SNAPSHOT")?"SNAPSHOT":"latest";return{version:r,tag:o,name:n.name}}catch(e){return null}},T=function(){return console.log("Use param --help or -h for help.")},N=function(e){return m.find(function(n){return n.name===e})},R=function(e,n,r){void 0===r&&(r="");try{var o=n.name,t=n.types,s="Installing package "+x(o)+"@"+e+" using "+p();return console.log(i(s)),Promise.resolve(k(g()+" "+x(n.name)+"@"+e+" "+r,x(o)+"@"+e.toUpperCase()+" installed successfully.")).then(function(){var e=t||[],n=function(){if(e.length>0)return Promise.resolve(k(g()+" --no-save "+A(e))).then(function(){})}();if(n&&n.then)return n.then(function(){})})}catch(e){return Promise.reject(e)}},E=function(e,n){void 0===e&&(e="latest"),void 0===n&&(n=[]);try{0===n.length&&(m.forEach(function(e){C(e.name)&&n.push(e.name)}),n.includes("core")||n.push("core"));var r=m.filter(function(e){return n.includes(e.name)});return Promise.resolve(k("rm -rf "+v.nodeModules+"/"+l)).then(function(){function n(){function n(){return Promise.resolve(function(n,r){try{var o=w(n,function(r){return Promise.resolve(function(n){try{var r=function(){var e=function(){if(t.length>0)return Promise.resolve(k(g()+" -D "+A(t))).then(function(){})}();if(e&&e.then)return e.then(function(){})},o=x(n.name),t=n.types||[],s=I(),c=C(n.name),a=function(){if(!c||!s)return console.log(i("Installing library "+o+"@"+e+" using "+p())),Promise.resolve(k(g()+" "+o+"@"+e)).then(function(){});var n=s.version,r=function(){if(c.version!==n)return console.log(i("Installing library "+o+"@"+n+" using "+p())),Promise.resolve(k(g()+" "+o+"@"+n)).then(function(){})}();return r&&r.then?r.then(function(){}):void 0}();return Promise.resolve(a&&a.then?a.then(r):r())}catch(e){return Promise.reject(e)}}(n[r])).then(function(){})});return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}(f)).then(function(){var e=function(){if(!d)return Promise.resolve(k("npm dedupe")).then(function(){})}();if(e&&e.then)return e.then(function(){})})}var r=S(f,function(n){function r(){var e=function(){if(s.length>0)return Promise.resolve(k(g()+" -D "+A(s))).then(function(){})}();if(e&&e.then)return e.then(function(){})}var o=function(e,n){return console.log(i("Installing library "+e+"@"+n+" using "+p()))},t=x(n.name),s=n.types||[],c=I(),a=C(n.name),u=function(){if(!a||!c)return o(t,e),Promise.resolve(k(g()+" "+t+"@"+e+" --no-save")).then(function(){});var n=c.version,r=function(){if(a.version!==n)return o(t,n),Promise.resolve(k(g()+" "+t+"@"+n+" --no-save")).then(function(){})}();return r&&r.then?r.then(function(){}):void 0}();return u&&u.then?u.then(r):r()});return r&&r.then?r.then(n):n()}var o=S(r,function(n){return Promise.resolve(R(e,n)).then(function(){})});return o&&o.then?o.then(n):n()})}catch(e){return Promise.reject(e)}},L={version:{param:["--version","-v"],description:"Check installed version of harmony",exec:function(){try{var e=I();return e?console.log(i("Installed version of harmony is \n"+s(e.version)+" (tag:"+e.tag+").")):(console.log(c("No installed version of harmony \nfound in this application.")),T()),console.log("\nHarmony is FA Solutions' framework\nfor React-based app development.\nThe CLI is made to manage harmony's \npackages and versioning in the apps.\nContributors:"),u.contributors.forEach(function(e){return console.log("  %s",e)}),Promise.resolve()}catch(e){return Promise.reject(e)}}},install:{param:["--install","-i"],description:"Install harmony's packages.",second:m.map(function(e){return e.name}).filter(function(e){return"core"!==e}),exec:function(){try{var e=t[1]?t[1].trim().toLowerCase():"",n=function(){if(""===e)console.log(c("Package name was not provided in command."));else{var n=function(){if("core"===e)return Promise.resolve(E()).then(function(){});var n=function(){if(N(e))return Promise.resolve(function(e){try{var n=I(),r=N(e),o=function(){if(n&&r){var o={init:"Installing package "+x(e)+"@"+n.tag+" using "+p(),success:x(e)+"@"+n.tag+" installed successfully."};return Promise.resolve(function(e){var n=e.pkg,r=n.name,o=n.types,t=void 0===o?[]:o,s=e.version,a=e.options,u=void 0===a?"":a,l=e.messages;try{var f=function(e,n){try{var o=function(){console.log(i(null==l?void 0:l.init));var e=x(r)+"@"+s,n=g()+" "+e+" "+u;return Promise.resolve(k(n,null==l?void 0:l.success)).then(function(){var e=A(t),n=g()+" --no-save "+e,r=function(){if(t.length>0)return Promise.resolve(k(n)).then(function(){})}();if(r&&r.then)return r.then(function(){})})}()}catch(e){return n()}return o&&o.then?o.then(void 0,n):o}(0,function(){console.log(c((null==l?void 0:l.error)||"Error occurred."))});return Promise.resolve(f&&f.then?f.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}({messages:o,version:n.tag,pkg:r})).then(function(){})}console.log(c("A version of @faharmony/core must be installed before installing other packages. \nTry running command again with tag params or no params (for latest).")),T()}();return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}(e)).then(function(){});console.log(c("Package name is incorrect.")),T()}();return n&&n.then?n.then(function(){}):void 0}();if(n&&n.then)return n.then(function(){})}}();return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}},module:{param:["--module","-m"],description:"Generate harmony module using plop.",second:["ModuleID (string with all-lowercase letters)"],example:"sample",exec:function(){try{var e=function(e){return console.log(i("Initiating module generator script...")),Promise.resolve(k("npx plop --plopfile "+v.nodeModules+l+"/"+r+"/plop.js "+n,'New module "'+n+'" is generated.',!0)).then(function(){})},n=t[1]?t[1].trim().toLowerCase():"";if(""===n)return console.log(c("ModuleID was not provided in command.")),T(),Promise.resolve();var r="module",o=C(r),s=N(r);return Promise.resolve(s?Promise.resolve(R(o&&o.tag||"latest",s,"--no-save")).then(e):e())}catch(e){return Promise.reject(e)}}},tag:{param:["--tag","-t"],description:"Install specific tagged version of harmony.",second:h,exec:function(){try{var e=t[1]?t[1].trim().toLowerCase():"";if(""===e)return console.log(c("Tag was not provided in command.")),console.log("[ "+h.join(", ")+" ]"),Promise.resolve();switch(e){case"latest":case"stable":return Promise.resolve(E("latest",[])).then(function(){});case"rc":case"freeze":return Promise.resolve(E("RC",[])).then(function(){});case"snapshot":case"dev":return Promise.resolve(E("SNAPSHOT",[])).then(function(){});default:return console.log(c("Package name is incorrect.")),T(),Promise.resolve()}}catch(e){return Promise.reject(e)}}},sync:{param:["--sync","-s"],description:"Synchronize current branch with FA_REACT_APP repo template.",exec:function(){try{return console.log(i("Stating sync...\n")),Promise.resolve(k("git remote add upstream git@bitbucket.org:fasolutions-ondemand/fa-react-app.git")).then(function(){return Promise.resolve(k("git fetch upstream")).then(function(){return Promise.resolve(k("git merge upstream/master")).then(function(e){"Already up to date."===e?console.log(s("The app is in sync.")):console.log(i("Syncing may require resolving some merge conflicts.\nResolve the conflicts and commit the changes."))})})})}catch(e){return Promise.reject(e)}}}},M="Welcome to FA harmâ˜¯ï¸ny CLI ",O=M.length+4,q=Array(O).join("â”"),H=(Array(O).join(" "),t.length?"Param: "+t.join(" "):"No param"),D=Array(M.length-H.length).join(" "),F="â”"+q+"â”“",_="â”ƒ  "+s(M)+"  â”ƒ",z="â”—"+q+"â”›",U="â”ƒ  "+H+D+"  â”ƒ";!function(){try{var e=function(){console.log(i("\nMade with ðŸ’œ at FA Solutions Oy.")+"\n"+a("https://github.com/faharmony/cli")+"\n"+q+"â”â”")};console.log("\n"+F+"\n"+_+"\n"+U+"\n"+z+"\n");var r=function(){if(t.length>0)return Promise.resolve(function(){try{var e=function(e){var t=!1;if(r)return e;function i(e){if(t)return e;console.log(n.red.bold("Error: The command is incorrect.")),T()}var s={name:"",exec:function(){return Promise.resolve()}};Object.entries(L).forEach(function(e){var n=e[0],r=e[1];"string"!=typeof r&&r.param.includes(o)&&(s={name:n,exec:r.exec})});var c=function(){if(""!==s.name)return Promise.resolve(s.exec()).then(function(){t=!0})}();return c&&c.then?c.then(i):i(c)},r=!1,o=t[0].trim().toLowerCase(),i=function(){if(["-h","--help"].includes(o))return Promise.resolve(function(){try{console.log("Usage: "+s("npx faharmony/cli [param]")),console.log("\nwhere param (optional, case-insensitive) is "+n.bold("one")+" of the following:");var e=n.bold,r=n.green,o=n.blue;for(var t in L){var i=L[t],c=i.param,a=i.description,u=i.second,l=i.example;console.log("\n"+e(c.join(", "))),a&&console.log("  "+a),u&&console.log("  Second param: "+o(u.join(", "))),console.log("  Eg.",r("npx faharmony/cli "+c[0]+" "+(l||(u?u[0]:""))))}return Promise.resolve()}catch(e){return Promise.reject(e)}}()).then(function(){r=!0})}();return Promise.resolve(i&&i.then?i.then(e):e(i))}catch(e){return Promise.reject(e)}}()).then(function(){});var e=I(),r=e?Promise.resolve(E(e.tag,[])).then(function(){}):Promise.resolve(E("latest")).then(function(){});return r&&r.then?r.then(function(){}):void 0}();r&&r.then?r.then(e):e()}catch(e){Promise.reject(e)}}();
